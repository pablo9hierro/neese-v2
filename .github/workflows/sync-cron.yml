name: ğŸ”„ Sync Cron - Magazord â†’ GHL
on:
  schedule:
    # Executa a cada 5 minutos
    - cron: '*/5 * * * *'
  
  # Permite execuÃ§Ã£o manual pelo dashboard do GitHub
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    name: Executar SincronizaÃ§Ã£o
    
    steps:
      - name: ğŸš€ Trigger Supabase Edge Function
        run: |
          echo "ğŸ”„ Iniciando sincronizaÃ§Ã£o via Supabase Edge Function..."
          
          response=$(curl -s -w "\n%{http_code}" \
            -X GET 'https://gyxjuxmwnwyansfoabyv.supabase.co/functions/v1/sync-cron' \
            -H 'Content-Type: application/json')
          
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          echo "ğŸ“Š Status HTTP: $http_code"
          echo "ğŸ“¦ Resposta: $body"
          
          if [ $http_code -ge 200 ] && [ $http_code -lt 300 ]; then
            echo "âœ… SincronizaÃ§Ã£o executada com sucesso!"
          else
            echo "âŒ Erro na sincronizaÃ§Ã£o!"
            exit 1
          fi
      
      - name: ğŸ“ Log de execuÃ§Ã£o
        if: always()
        run: |
          echo "â° Executado em: $(date)"
          echo "ğŸ”— Projeto: neese"
          echo "ğŸ¯ Supabase Project: gyxjuxmwnwyansfoabyv"
